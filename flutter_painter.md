你是一位经验丰富的 Flutter 和 Riverpod 专家，同时也是一位熟练的 macOS 应用设计师，并且对 `flutter_painter` 包有着深入的了解。你的任务是为 Snipwise 截图编辑器设计一个完整的、基于 Riverpod 的状态管理系统，并集成 `flutter_painter` 的所有功能。  该编辑器支持对截图进行标注，包括：矩形框、箭头、自由绘图和文本。  该系统需要能够处理用户交互，并提供 macOS 风格的 UI 元素。
所有设计创建都要完全符合fultter最佳实践，请学习flutter的专业知识，macos的设计知识

**1. `flutter_painter` 功能和状态管理:**

请详细描述 `flutter_painter` 的核心功能，并设计一个基于 Riverpod 的状态管理系统来管理这些功能。熟读 `flutter_painter`的代码开发文档


*   **`PainterController` 初始化和配置:** 如何初始化和配置 `PainterController`，包括设置背景颜色，缩放限制，以及其他相关属性。  请提供代码片段示例，展示如何初始化和配置 `PainterController`。
*   **`Drawable` 对象和状态:** 详尽列出 `flutter_painter` 支持的 `Drawable` 对象类型或至少列举最常用且功能丰富的类型。  为每种 `Drawable` 类型，详细描述其可配置的状态属性，并设计相应的 Riverpod Provider 来管理这些状态：
    *   `RectangleDrawable`： `strokeColor` (颜色，默认红色), `strokeWidth` (线宽，默认 1), `fillColor` (填充颜色，默认透明), `cornerRadius` (圆角半径，默认 0)。
    *   `PathDrawable`：`strokeColor` (颜色，默认黑色), `strokeWidth` (线宽，默认 1), `strokeCap` (线帽样式), `strokeJoin` (线连接样式), `style` (实线/虚线)。
    *   `ImageDrawable`：`imagePath` (图片路径), `scale` (缩放比例), `rotation` (旋转角度)。
    *   `TextDrawable` (如果存在，否则自定义类似的)：`text` (文本内容), `fontSize` (字号，默认 14), `fontFamily` (字体，默认 Roboto), `textColor` (文字颜色，默认黑色), `textAlign` (文字对齐方式)。
    *   自定义 `Drawable`：例如，一个自定义的箭头 `Drawable`，需要哪些状态属性？
*   **对象管理:**  设计 Riverpod Provider 来管理 `Drawable` 对象列表，支持添加、删除、更新、选择、分组、取消分组、排序、变换（旋转、缩放、平移）、复制、粘贴操作。  详细描述如何实现多选功能和选中状态的管理。  请提供代码片段示例，展示如何使用 Riverpod 来管理 `Drawable` 对象。
*   **事件处理:**  描述如何监听 `flutter_painter` 提供的事件，例如：手势识别（平移、缩放、旋转）、点击事件、长按事件、双击事件等。  如何将这些事件映射到你的状态管理系统中，并触发相应的操作？  请提供代码片段示例，展示如何监听事件并更新状态。


**2.  状态系统设计:**

设计一个分层的状态管理系统，包含：

*   **系统默认状态:**  设置一个系统默认状态，包含线宽 (默认 1)，框颜色 (默认红)，框填充色 (默认透明)，文字大小 (默认 14)，字体 (默认 Roboto)，文字颜色 (默认黑色)。 使用 Riverpod Provider 来定义并管理这个默认状态。
*   **工具专属状态:**  每个工具（例如，线条工具、矩形工具、文本工具）可以拥有自己的一套状态。当用户选择工具时，该工具的状态会覆盖系统默认状态，仅在第一次选择时覆盖。  再次选择该工具时，只更新该工具的状态，不影响系统默认状态。  例如：用户点击线条工具，工具栏下方出现线条粗细颜色选择器，用户选择后，该线条状态覆盖系统的线条状态。之后再次点击线条工具，用户更新线宽，则只会更新线条工具的线宽状态，系统默认状态保持不变。  请设计相应的 Riverpod Provider 来管理每个工具的状态。
*   **对象实例状态:**  每个 `Drawable` 对象拥有自身的状态，该状态可以通过编辑器进行修改。 修改对象实例状态时，不修改任何全局状态 (系统默认状态或工具专属状态)。


**3.  工具栏设计:**

`flutter_painter` 可能没有提供所有需要的工具按钮。请设计一个符合 macOS 风格的工具栏，并包含以下功能：

*   选择工具
*   矩形工具
*   箭头工具
*   自由绘图工具
*   文本工具
*   撤销/重做按钮
*   清除所有标注按钮
*   导出图片按钮

对于每个功能，列出需要调整的状态。 例如：

*   线条工具：`strokeWidth`，`strokeColor`
*   矩形工具：`strokeWidth`，`strokeColor`，`fillColor`
*   文本工具：`fontSize`，`fontFamily`，`textColor`


**4.  自定义 Drawable 和状态管理:**

设计 `TextDrawableWithBorder`  (或类似的文本 `Drawable`)，包含边框和背景。  这个 `Drawable` 应该能够根据文字内容自动调整大小，并在文字周围保留 3 个像素的 padding。  当用户点击文本框时，在工具栏下方出现选项来修改文本的属性（字体、颜色、大小）。  请提供代码示例展示这个自定义 `Drawable` 的实现以及状态管理。


**5.  整体架构和 Riverpod Provider:**

设计一个清晰的 Riverpod Provider 架构，来管理所有状态和功能。  请提供一个图表或文字描述来展现你的设计方案，包含所有 Provider 之间的依赖关系。  请根据 macOS 设计师的风格，设计状态选择器。




**V.  界面文字缓存与显示功能 (新增)**

1.  **缓存机制:**  设计一个机制，能够缓存所有界面上的文字内容。  考虑以下情况：
    *   文本标注的文字内容。
    *   工具栏按钮上的文字内容。
    *   其他UI元素上的文字内容（如果有）。
    *   如何处理动态变化的文本内容？  例如，用户编辑文本标注时，缓存如何更新？

    建议使用一个Riverpod Provider来存储缓存的文字内容。  这个Provider的数据类型可以是一个List<String>，其中每个String代表一个界面文字。

2.  **显示按钮:**  设计一个按钮，点击后显示所有缓存的文字内容。  这个按钮可以放置在工具栏上，或其他合适的位置。  UX设计师需要考虑按钮的视觉设计，以及与整体UI风格的一致性。

3.  **显示方式:**  设计如何显示缓存的文字内容。  要求每项文字内容都换行处理。  可以使用一个对话框、一个新的页面，或者一个浮层来显示这些文字内容。  建议使用一个可滚动的容器，以便能够显示大量的文字内容。  UX设计师需要考虑文字的排版，确保阅读体验良好。

4.  **性能考虑:**  缓存机制和显示方式需要考虑性能因素。  缓存的文字内容不应过大，以免影响应用程序的性能。  显示方式也需要高效，避免卡顿或延迟。  Flutter专家需要提供相应的代码示例，以及性能优化的策略。


**VI.  最终交付物 (新增显示文字功能)**

除了之前的交付物外，还需包含以下内容：

*   缓存机制的设计说明，以及对应的Riverpod Provider的设计。
*   显示按钮的UI设计。
*   文字内容显示方式的设计，以及相关的代码片段示例。
*   性能优化策略。


III. 用户体验设计 (UX设计师)**

1.  **工具栏设计:**  设计符合macOS风格的工具栏，包含所有功能按钮，并提供清晰的视觉反馈。
2.  **状态选择器设计:**  设计符合macOS风格的样式选择器 (线条粗细、颜色、字体、大小等)，提供直观的交互方式。  提供UI设计草图或详细描述。
3.  **用户流程:**  描述用户添加标注、修改样式、撤销/重做等操作的流程，确保流程流畅自然。
4.  **视觉风格:**  所有UI元素必须符合macOS的视觉风格指南。
生成主要 UI 的低保真线框图或模型图，包括工具栏、状态选择器（颜色选择器、线宽滑块等）以及显示文本摘要的对话框。

请提供一份完整的开发文档，包含：

*   详细的设计说明，包括文字描述、架构图、UI设计草图。
*   关键代码片段示例 (Riverpod Provider, `Drawable`实现, 事件处理, 状态更新逻辑等)。
*   潜在性能问题的分析和解决方案。
*   测试策略建议。


